<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-Hans">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="前几天在上传一个个人项目的时候老是报这个错误，
ERROR ITMS-90096: &amp;quot;Your binary is not optimized for iPhone 5 - New iPhone apps and app updates submitted must support the 4-inch display on iPhone 5 and must include a lau">
<meta property="og:type" content="article">
<meta property="og:title" content="：日常bug记录">
<meta property="og:url" content="http://yoursite.com/child/2016/07/15/踏过的坑/index.html">
<meta property="og:site_name" content="不要急，不要怕">
<meta property="og:description" content="前几天在上传一个个人项目的时候老是报这个错误，
ERROR ITMS-90096: &amp;quot;Your binary is not optimized for iPhone 5 - New iPhone apps and app updates submitted must support the 4-inch display on iPhone 5 and must include a lau">
<meta property="og:image" content="http://i1.piimg.com/567571/9d2e87a2cd4c4304.jpg">
<meta property="og:image" content="http://i1.piimg.com/567571/545a8322b61e9e50.jpg">
<meta property="og:image" content="http://p1.bqimg.com/567571/11a1980ccd87c787.png">
<meta property="og:updated_time" content="2017-03-29T03:24:30.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="：日常bug记录">
<meta name="twitter:description" content="前几天在上传一个个人项目的时候老是报这个错误，
ERROR ITMS-90096: &amp;quot;Your binary is not optimized for iPhone 5 - New iPhone apps and app updates submitted must support the 4-inch display on iPhone 5 and must include a lau">
<meta name="twitter:image" content="http://i1.piimg.com/567571/9d2e87a2cd4c4304.jpg">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: '博主'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/child/2016/07/15/踏过的坑/"/>





  <title> ：日常bug记录 | 不要急，不要怕 </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-Hans">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">不要急，不要怕</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Life needs curiosity and passion.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            首页
          </a>
        </li>
      
        
        <li class="menu-item menu-item-about">
          <a href="/about" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-user"></i> <br />
            
            关于
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            归档
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            标签
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://yoursite.com/child/2016/07/15/踏过的坑/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="hapii">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="http://tva1.sinaimg.cn/crop.0.14.750.750.180/005PluWajw8fahgdnankoj30ku0lnjsd.jpg">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="不要急，不要怕">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="不要急，不要怕" src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                ：日常bug记录
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-07-15T18:00:58+08:00">
                2016-07-15
              </time>
            

            

            
          </span>

          
            <span class="post-category" >
              <span class="post-meta-divider">|</span>
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
              
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/日常Bug/" itemprop="url" rel="index">
                    <span itemprop="name">日常Bug</span>
                  </a>
                </span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <a href="/2016/07/15/踏过的坑/#comments" itemprop="discussionUrl">
                  <span class="post-comments-count ds-thread-count" data-thread-key="2016/07/15/踏过的坑/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          

          
          
             <span id="/2016/07/15/踏过的坑/" class="leancloud_visitors" data-flag-title="：日常bug记录">
               <span class="post-meta-divider">|</span>
               <span class="post-meta-item-icon">
                 <i class="fa fa-eye"></i>
               </span>
               <span class="post-meta-item-text">阅读次数 </span>
               <span class="leancloud-visitors-count"></span>
              </span>
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <p>前几天在上传一个个人项目的时候老是报这个错误，</p>
<pre><code>ERROR ITMS-90096: &quot;Your binary is not optimized for iPhone 5 - New iPhone apps and app updates submitted must support the 4-inch display on iPhone 5 and must include a launch image referenced in the Info.plist under UILaunchImages with a UILaunchImageSize value set to {320, 568}. Launch images must be PNG files and located at the top-level of your bundle, or provided within each .lproj folder if you localize your launch images. Learn more about iPhone 5 support and app launch images by reviewing the &apos;iOS Human Interface Guidelines&apos; at &apos;https://developer.apple.com/library/ios/documentation/UserExperience/Conceptual/MobileHIG/IconsImages/IconsImages.html#//apple_ref/doc/uid/TP40006556-CH14-SW5&apos; and the &apos;iOS App Programming Guide&apos; at &apos;https://developer.apple.com/library/ios/documentation/iPhone/Conceptual/iPhoneOSProgrammingGuide/App-RelatedResources/App-RelatedResources.html#//apple_ref/doc/uid/TP40007072-CH6-SW12&apos;.&quot;
</code></pre><p>默认的 LaunchImage 我都已经加完了，还报这个错误。</p>
<p>解决的方法是：添加一个图片名称为 Default-568h@2x.png 的png图片，大小是 640 × 1136 就可以了。</p>
<h2 id="iOS-10-不提示「是否允许应用访问数据」"><a href="#iOS-10-不提示「是否允许应用访问数据」" class="headerlink" title="iOS 10 不提示「是否允许应用访问数据」:"></a>iOS 10 不提示「是否允许应用访问数据」:</h2><p>由于大陆相关部门出台的新规定指出，应用在未经用户允许的前提下，系统不能授予其使用联网、获取定位的功能。Apple 在 iOS 10 操作系统中加入了关于应用使用数据的授权弹窗提示，用户在 iOS 10 系统中第一次打开应用时，会被要求对于是否授予应用联网权限进行选择。<br><img src="http://i1.piimg.com/567571/9d2e87a2cd4c4304.jpg" alt="就像这样"></p>
<p>如果你在 iOS 10 操作系统中安装了一个新应用或者第一次打开某个应用时发现应用出现无法访问网络无法刷新数据的情况，并且在蜂窝数据网络的设置项中无法找到相应应用的联网权限设置选项，出现如下的这种情况，恭喜你，你中招了。<br><img src="http://i1.piimg.com/567571/545a8322b61e9e50.jpg" alt="连不上网"><br>而且点到设置，app对应的权限下也没有“无限数据”这个选项</p>
<h2 id="解决方案"><a href="#解决方案" class="headerlink" title="####解决方案:"></a>####解决方案:</h2><p>由于这个 Bug 是系统级别的，所以暂时没有方便的解决方案。</p>
<p>下面总结两条目前可行的解决方案：</p>
<p>方案一： 重启手机再打开有相关联网问题的应用<br>对于此问题可能带来的问题有：如果你有多个应用具有网络访问问题，你可能需要多次重启设备后依次打开相关应用，因为在每次重启设备之后，系统貌似只能修正一个应用的联网访问请求，关于此问题还需要进一步求证。</p>
<p>方案二：更改 iOS 10 中的蜂窝网络访问权限设置<br>除了重启设别以外，你也可以尝试在「设置-通用-蜂窝移动网络-使用无线局域网与蜂窝移动的应用」选项中更改任意应用的联网权限设置后再恢复原先设置选项，完成操作后再次打开相关问题应用，也可以解决这一问题。</p>
<p>方案三：临时启动无线局域网助理<br>在「设置」-「蜂窝移动网络」打开「无线局域网助理」选项，之后再打开相关问题应用也可以解决这个问题。</p>
<p>修复问题后即可关闭「无线局域网助理」选项。<br><a href="http://www.jianshu.com/p/28e8919a2cae" target="_blank" rel="external">原文地址</a></p>
<h2 id="app被拒后提交材料踏过的坑"><a href="#app被拒后提交材料踏过的坑" class="headerlink" title="app被拒后提交材料踏过的坑:"></a>app被拒后提交材料踏过的坑:</h2><p>被拒的理由balibalibali~~：</p>
<pre><code>Your app includes features for streaming TV channels, the content of which may be copyrighted. The use of third-party copyrighted materials requires documented evidence of your right to use such content in your app.

We&apos;ve attached screenshot(s) for your reference.

Pursuant to the terms of this agreement, you represent and warrant that your app does not infringe the rights of another party, and that you are responsible for any liability to Apple because of a claim that your app infringes another party&apos;s rights. Moreover, we may reject or remove your app for any reason, at our sole discretion.

Next Steps

Please provide documentary evidence of rights to use this content and features. Once Legal has reviewed your documentation and confirms its validity, we will proceed with the review of your app.

Alternatively, please remove these features and content from your app and its metadata.

Screenshot 0104 113900.png
Screenshot 0104 113725.png
</code></pre><p><img src="http://p1.bqimg.com/567571/11a1980ccd87c787.png" alt="点击附加文件传图片"><br>这里⚠️⚠️,上传的图片名字不能有汉字，不然传不上去～～</p>
<h2 id="linker-command-failed-with-exit-code-1"><a href="#linker-command-failed-with-exit-code-1" class="headerlink" title="linker command failed with exit code 1:"></a>linker command failed with exit code 1:</h2><p>这个报错太恶心了，原因也太多，纪录几个我的解决方案：<br>1.在编译工程时，有时会遇到类似“ld: library not found for -l….”的错误提示。</p>
<p>原因是你的某个库的连接引用有问题，工程在编译时找不到需要的链接库而导致的。</p>
<p>解决的办法就是在项目的target里,选中Link Binary With Libraries 里的.a或framework 取消再加入,就可以了<br>或者在工程的Target中选中要执行编译的某个target,然后“get info”,打开Build设置页面，<br>在“Library Search Path”中添加缺失链接库的所在文件夹的路径或$(inherited)即可</p>
<p>ld:warning:directory not found option 的问题可能是framework search paths 还有Library Search Paths 里面并没有这个路径,删除即可</p>
<h2 id="MJRefresh的bug"><a href="#MJRefresh的bug" class="headerlink" title="MJRefresh的bug:"></a>MJRefresh的bug:</h2><p><a href="https://github.com/CoderMJLee/MJRefresh/issues/746" target="_blank" rel="external">点这里</a><br>语言国际化时英文是报错，难怪毕业设计每次打回来都说是ipv6或者是秒退～～恍然大悟。。</p>
<h2 id="屏幕旋转相关"><a href="#屏幕旋转相关" class="headerlink" title="屏幕旋转相关:"></a>屏幕旋转相关:</h2><p>在项目中难免要碰到屏幕旋转，每次要卡那么一下，这次是死活不走下面这个方法了，</p>
<pre><code>- (void)willRotateToInterfaceOrientation:(UIInterfaceOrientation)toInterfaceOrientation duration:(NSTimeInterval)duration
</code></pre><p>原来是因为VIewController跳转时resenting view controllers on detached view controllers is discouraged，<br>把跳转修改：</p>
<pre><code>[wself presentViewController:navi animated:YES     completion:^{
   }];
</code></pre><p>改为</p>
<pre><code>[wself.view.window.rootViewController presentViewController:navi animated:YES completion:nil];
</code></pre>
      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">


      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2015/10/20/button不能点击的原因/" rel="next" title="button不能点击的原因">
                <i class="fa fa-chevron-left"></i> button不能点击的原因
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2016/10/10/NSUserDefaults须知/" rel="prev" title="NSUserDefaults须知">
                NSUserDefaults须知 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>


          </div>
          


          
  <div class="comments" id="comments">
    
      <div class="ds-thread" data-thread-key="2016/07/15/踏过的坑/"
           data-title="：日常bug记录" data-url="http://yoursite.com/child/2016/07/15/踏过的坑/">
      </div>
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap" >
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="http://tva1.sinaimg.cn/crop.0.14.750.750.180/005PluWajw8fahgdnankoj30ku0lnjsd.jpg"
               alt="hapii" />
          <p class="site-author-name" itemprop="name">hapii</p>
          <p class="site-description motion-element" itemprop="description">Stay Hungry. Stay Foolish.</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">33</span>
              <span class="site-state-item-name">日志</span>
            </a>
          </div>

          
            <div class="site-state-item site-state-categories">
              
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">分类</span>
              
            </div>
          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">8</span>
                <span class="site-state-item-name">标签</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
            
              <span class="links-of-author-item">
                <a href="https://github.com/hapiii" target="_blank" title="GitHub">
                  
                    <i class="fa fa-fw fa-github"></i>
                  
                  GitHub
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://weibo.com/5339381110/profile?topnav=1&wvr=6&is_all=1" target="_blank" title="微博">
                  
                    <i class="fa fa-fw fa-globe"></i>
                  
                  微博
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="http://www.jianshu.com/users/d746cffd2a58/timeline" target="_blank" title="简书">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  简书
                </a>
              </span>
            
              <span class="links-of-author-item">
                <a href="https://www.zhihu.com/people/oncezhu/activities" target="_blank" title="知乎">
                  
                    <i class="fa fa-fw fa-twitter"></i>
                  
                  知乎
                </a>
              </span>
            
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#iOS-10-不提示「是否允许应用访问数据」"><span class="nav-number">1.</span> <span class="nav-text">iOS 10 不提示「是否允许应用访问数据」:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#解决方案"><span class="nav-number">2.</span> <span class="nav-text">####解决方案:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#app被拒后提交材料踏过的坑"><span class="nav-number">3.</span> <span class="nav-text">app被拒后提交材料踏过的坑:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#linker-command-failed-with-exit-code-1"><span class="nav-number">4.</span> <span class="nav-text">linker command failed with exit code 1:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#MJRefresh的bug"><span class="nav-number">5.</span> <span class="nav-text">MJRefresh的bug:</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#屏幕旋转相关"><span class="nav-number">6.</span> <span class="nav-text">屏幕旋转相关:</span></a></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2018</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">hapii</span>
</div>


<div class="powered-by">
  由 <a class="theme-link" href="https://hexo.io">Hexo</a> 强力驱动
</div>

<div class="theme-info">
  主题 -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  

  
    
  

  <script type="text/javascript">
    var duoshuoQuery = {short_name:"hapii"};
    (function() {
      var ds = document.createElement('script');
      ds.type = 'text/javascript';ds.async = true;
      ds.id = 'duoshuo-script';
      ds.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') + '//static.duoshuo.com/embed.js';
      ds.charset = 'UTF-8';
      (document.getElementsByTagName('head')[0]
      || document.getElementsByTagName('body')[0]).appendChild(ds);
    })();
  </script>

  
    
    
    <script src="/lib/ua-parser-js/dist/ua-parser.min.js?v=0.7.9"></script>
    <script src="/js/src/hook-duoshuo.js"></script>
  








  
  

  

  

  
  <script src="https://cdn1.lncld.net/static/js/av-core-mini-0.6.1.js"></script>
  <script>AV.initialize("zc81aNb6TWWwuKFCHYYHVEwj-gzGzoHsz", "fzUiJKfzp0BdJLPgoyW4Tf5w");</script>
  <script>
    function showTime(Counter) {
      var query = new AV.Query(Counter);
      var entries = [];
      var $visitors = $(".leancloud_visitors");

      $visitors.each(function () {
        entries.push( $(this).attr("id").trim() );
      });

      query.containedIn('url', entries);
      query.find()
        .done(function (results) {
          var COUNT_CONTAINER_REF = '.leancloud-visitors-count';

          if (results.length === 0) {
            $visitors.find(COUNT_CONTAINER_REF).text(0);
            return;
          }

          for (var i = 0; i < results.length; i++) {
            var item = results[i];
            var url = item.get('url');
            var time = item.get('time');
            var element = document.getElementById(url);

            $(element).find(COUNT_CONTAINER_REF).text(time);
          }
          for(var i = 0; i < entries.length; i++) {
            var url = entries[i];
            var element = document.getElementById(url);
            var countSpan = $(element).find(COUNT_CONTAINER_REF);
            if( countSpan.text() == '') {
              countSpan.text(0);
            }
          }
        })
        .fail(function (object, error) {
          console.log("Error: " + error.code + " " + error.message);
        });
    }

    function addCount(Counter) {
      var $visitors = $(".leancloud_visitors");
      var url = $visitors.attr('id').trim();
      var title = $visitors.attr('data-flag-title').trim();
      var query = new AV.Query(Counter);

      query.equalTo("url", url);
      query.find({
        success: function(results) {
          if (results.length > 0) {
            var counter = results[0];
            counter.fetchWhenSave(true);
            counter.increment("time");
            counter.save(null, {
              success: function(counter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(counter.get('time'));
              },
              error: function(counter, error) {
                console.log('Failed to save Visitor num, with error message: ' + error.message);
              }
            });
          } else {
            var newcounter = new Counter();
            /* Set ACL */
            var acl = new AV.ACL();
            acl.setPublicReadAccess(true);
            acl.setPublicWriteAccess(true);
            newcounter.setACL(acl);
            /* End Set ACL */
            newcounter.set("title", title);
            newcounter.set("url", url);
            newcounter.set("time", 1);
            newcounter.save(null, {
              success: function(newcounter) {
                var $element = $(document.getElementById(url));
                $element.find('.leancloud-visitors-count').text(newcounter.get('time'));
              },
              error: function(newcounter, error) {
                console.log('Failed to create');
              }
            });
          }
        },
        error: function(error) {
          console.log('Error:' + error.code + " " + error.message);
        }
      });
    }

    $(function() {
      var Counter = AV.Object.extend("Counter");
      if ($('.leancloud_visitors').length == 1) {
        addCount(Counter);
      } else if ($('.post-title-link').length > 1) {
        showTime(Counter);
      }
    });
  </script>



  

  


</body>
</html>
